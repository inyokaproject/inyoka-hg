(function(b){b.fn.visualize=function(G,y){return b(this).each(function(){var d=b.extend({type:"bar",width:b(this).width(),height:b(this).height(),appendTitle:true,title:null,appendKey:true,colors:["#be1e2d","#666699","#92d5ea","#ee8310","#8d10ee","#5a3b16","#26a4ed","#f45a90","#e9e744"],textColors:[],parseDirection:"x",pieMargin:20,pieLabelPos:"inside",lineWeight:4,barGroupMargin:10,barMargin:1,yLabelInterval:30},G);d.width=parseFloat(d.width);d.height=parseFloat(d.height);var q=b(this),D={pie:function(){r.addClass("visualize-pie");
d.pieLabelPos=="outside"&&r.addClass("visualize-pie-outside");var k=Math.round(g.width()/2),l=Math.round(g.height()/2),a=l-d.pieMargin,f=0,i=b('<ul class="visualize-labels"></ul>').insertAfter(g);b.each(H,function(c){var h=this<=0||isNaN(this)?0:this/I;e.beginPath();e.moveTo(k,l);e.arc(k,l,a,f*Math.PI*2-Math.PI*0.5,(f+h)*Math.PI*2-Math.PI*0.5,false);e.lineTo(k,l);e.closePath();e.fillStyle=o[c].color;e.fill();var j=f+h/2,m=d.pieLabelPos=="inside"?a/1.5:a+a/5,s=Math.round(k+Math.sin(j*Math.PI*2)*m);
j=Math.round(l-Math.cos(j*Math.PI*2)*m);m=s>k?"right":"left";var t=j>l?"bottom":"top",n=Math.round(h*100);if(n){(n=b('<span class="visualize-label">'+n+"%</span>").css(m,0).css(t,0))&&b('<li class="visualize-label-pos"></li>').appendTo(i).css({left:s,top:j}).append(n);n.css("font-size",a/8).css("margin-"+m,-n.width()/2).css("margin-"+t,-n.outerHeight()/2);o[c].textColor&&n.css("color",o[c].textColor)}f+=h})},line:function(k){k?r.addClass("visualize-area"):r.addClass("visualize-line");var l=g.width()/
(w.length-1),a=b('<ul class="visualize-labels-x"></ul>').width(g.width()).height(g.height()).insertBefore(g);b.each(w,function(h){var j=b("<li><span>"+this+"</span></li>").prepend('<span class="line" />').css("left",l*h).appendTo(a).find("span:not(.line)"),m=j.width()/-2;if(h==0)m=0;else if(h==w.length-1)m=-j.width();j.css("margin-left",m).addClass("label")});var f=g.height()/x,i=g.height()/(u.length-1),c=b('<ul class="visualize-labels-y"></ul>').width(g.width()).height(g.height()).insertBefore(g);
b.each(u,function(h){var j=b("<li><span>"+this+"</span></li>").prepend('<span class="line"  />').css("bottom",i*h).prependTo(c).find("span:not(.line)"),m=j.height()/-2;if(h==0)m=-j.height();else if(h==u.length-1)m=0;j.css("margin-top",m).addClass("label")});e.translate(0,C);b.each(o,function(){e.beginPath();e.lineWidth=d.lineWeight;e.lineJoin="round";var h=this.points,j=0;e.moveTo(0,-(h[0]*f));b.each(h,function(){e.lineTo(j,-(this*f));j+=l});e.strokeStyle=this.color;e.stroke();if(k){e.lineTo(j,0);
e.lineTo(0,0);e.closePath();e.fillStyle=this.color;e.globalAlpha=0.3;e.fill();e.globalAlpha=1}else e.closePath()})},area:function(){D.line(true)},bar:function(){r.addClass("visualize-bar");var k=g.width()/w.length,l=b('<ul class="visualize-labels-x"></ul>').width(g.width()).height(g.height()).insertBefore(g);b.each(w,function(n){b('<li><span class="label">'+this+"</span></li>").prepend('<span class="line" />').css("left",k*n).width(k).appendTo(l).find("span.label").addClass("label")});var a=g.height()/
x,f=g.height()/(u.length-1),i=b('<ul class="visualize-labels-y"></ul>').width(g.width()).height(g.height()).insertBefore(g);b.each(u,function(n){var z=b("<li><span>"+this+"</span></li>").prepend('<span class="line"  />').css("bottom",f*n).prependTo(i).find("span:not(.line)"),A=z.height()/-2;if(n==0)A=-z.height();else if(n==u.length-1)A=0;z.css("margin-top",A).addClass("label")});e.translate(0,C);for(var c=0;c<o.length;c++){e.beginPath();var h=(k-d.barGroupMargin*2)/o.length;e.lineWidth=h-d.barMargin*
2;for(var j=o[c].points,m=0,s=0;s<j.length;s++){var t=m-d.barGroupMargin+c*h+h/2;t+=d.barGroupMargin*2;e.moveTo(t,0);e.lineTo(t,Math.round(-j[s]*a));m+=k}e.strokeStyle=o[c].color;e.stroke();e.closePath()}}},v=document.createElement("canvas");v.setAttribute("height",d.height);v.setAttribute("width",d.width);var g=b(v);v=d.title||q.find("caption").text();var r=(y||b('<div class="visualize" role="img" aria-label="Chart representing data from the table: '+v+'" />')).height(d.height).width(d.width).append(g),
p=function(){var k=d.colors,l=d.textColors;return{dataGroups:function(){var a=[];if(d.parseDirection=="x")q.find("tr:gt(0)").each(function(c){a[c]={};a[c].points=[];a[c].color=k[c];if(l[c])a[c].textColor=l[c];b(this).find("td").each(function(){a[c].points.push(parseFloat(b(this).text()))})});else for(var f=q.find("tr:eq(1) td").size(),i=0;i<f;i++){a[i]={};a[i].points=[];a[i].color=k[i];if(l[i])a[i].textColor=l[i];q.find("tr:gt(0)").each(function(){a[i].points.push(b(this).find("td").eq(i).text()*
1)})}return a},allData:function(){var a=[];b(this.dataGroups()).each(function(){a.push(this.points)});return a},dataSum:function(){var a=0,f=this.allData().join(",").split(",");b(f).each(function(){a+=parseFloat(this)});return a},topValue:function(){var a=0,f=this.allData().join(",").split(",");b(f).each(function(){if(parseFloat(this,10)>a)a=parseFloat(this)});return a},bottomValue:function(){var a=0,f=this.allData().join(",").split(",");b(f).each(function(){if(this<a)a=parseFloat(this)});return a},
memberTotals:function(){var a=[],f=this.dataGroups();b(f).each(function(i){var c=0;b(f[i].points).each(function(h){c+=f[i].points[h]});a.push(c)});return a},yTotals:function(){for(var a=[],f=this.dataGroups(),i=this.xLabels().length,c=0;c<i;c++){a[c]=[];var h=0;b(f).each(function(){a[c].push(this.points[c])});a[c].join(",").split(",");b(a[c]).each(function(){h+=parseFloat(this)});a[c]=h}return a},topYtotal:function(){var a=0,f=this.yTotals().join(",").split(",");b(f).each(function(){if(parseFloat(this,
10)>a)a=parseFloat(this)});return a},totalYRange:function(){return this.topValue()-this.bottomValue()},xLabels:function(){var a=[];d.parseDirection=="x"?q.find("tr:eq(0) th").each(function(){a.push(b(this).html())}):q.find("tr:gt(0) th").each(function(){a.push(b(this).html())});return a},yLabels:function(){var a=[];a.push(J);for(var f=Math.ceil(x/Math.round(d.height/d.yLabelInterval))||1;a[a.length-1]<B-f;)a.push(a[a.length-1]+f);a.push(B);return a}}}(),o=p.dataGroups();p.allData();var I=p.dataSum(),
B=p.topValue(),J=p.bottomValue(),H=p.memberTotals(),x=p.totalYRange(),C=d.height*(B/x),w=p.xLabels(),u=p.yLabels();if(d.appendTitle||d.appendKey)var E=b('<div class="visualize-info"></div>').appendTo(r);d.appendTitle&&b('<div class="visualize-title">'+v+"</div>").appendTo(E);if(d.appendKey){var F=b('<ul class="visualize-key"></ul>');q.find(d.parseDirection=="x"?"tr:gt(0) th":"tr:eq(0) th").each(function(k){b('<li><span class="visualize-key-color" style="background: '+o[k].color+'"></span><span class="visualize-key-label">'+
b(this).text()+"</span></li>").appendTo(F)});F.appendTo(E)}y||r.insertAfter(this);if(typeof G_vmlCanvasManager!="undefined"){G_vmlCanvasManager.init();G_vmlCanvasManager.initElement(g[0])}var e=g[0].getContext("2d");D[d.type]();b(".visualize-line li:first-child span.line, .visualize-line li:last-child span.line, .visualize-area li:first-child span.line, .visualize-area li:last-child span.line, .visualize-bar li:first-child span.line,.visualize-bar .visualize-labels-y li:last-child span.line").css("border",
"none");y||r.bind("visualizeRefresh",function(){q.visualize(d,b(this).empty())})}).next()}})(jQuery);
