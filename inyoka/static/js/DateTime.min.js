$(function(){var m=["Januar","Februar","M\u00e4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],n=["S","M","D","M","D","F","S"],l=Class.$extend({__init__:function(b,c,a){var e=this;this.input=$(b).click(function(){$("table.datetime").each(function(){e.container[0]!==this?$(this).hide():e.show()});return false});this.auto_show=c||false;this.only_date=a||false;this.readDateTime();this.container=$('<table class="datetime"></table>').click(function(){return false});
c?this.container.hide().addClass("auto_show"):this.input.hide();b=$("<tr></tr>").appendTo(this.container);this.calendar=$("<td></td>").appendTo(b);this.timetable=$("<td></td>").appendTo(b);this.drawDate(this.currentYear,this.currentMonth);this.drawTimetable();if(a){this.timetable.hide();this.currentTime="00:00:00"}this.input.after(this.container)},show:function(){this.readDateTime();this.drawDate(this.currentYear,this.currentMonth);this.container.css({position:"absolute",left:this.input.offset().left}).show();
if(this.only_date){this.timetable.hide();this.currentTime="00:00:00"}},readDateTime:function(){var b=this,c=function(f,d,g,j){b.currentYear=parseInt(f,10);b.currentMonth=parseInt(d,10);b.currentDay=parseInt(g,10);b.currentTime=j},a=this.input.val(),e=/(\d{4})-(\d{1,2})-(\d{1,2}) (\d{2}):(\d{2}):(\d{2})/.exec(a);if(a==""||!e){a=new Date;c(a.getFullYear(),a.getMonth()+1,a.getDate(),[a.getHours(),a.getMinutes(),a.getSeconds()].join(":"))}else c(RegExp.$1,RegExp.$2,RegExp.$3,[RegExp.$4,RegExp.$5,RegExp.$6].join(":"))},
writeDateTime:function(){this.input.val(this.currentYear+"-"+this.currentMonth+"-"+this.currentDay);this.only_date||this.input.val(this.input.val()+" "+this.currentTime)},drawTimetable:function(){var b=this,c=$('<table class="timetable"></table>').append($('<tr><th class="caption">Uhrzeit</th></tr>'));this.timetable.append(c);var a=new Date;a=[["Jetzt",[a.getHours(),a.getMinutes(),a.getSeconds()].join(":")],["Mitternacht","00:00:00"],["6 Uhr","06:00:00"],["Mittag","12:00:00"],["18 Uhr","18:00:00"]];
$.each(a,function(e,f){c.append($("<tr></tr>").append($("<td></td>").append($("<a/>").text(f[0]).click(function(){b.currentTime=f[1];b.writeDateTime();return false}))))});a=$("<td></td>").appendTo($("<tr></tr>").appendTo(c));this.auto_show&&$('<a class="close">Schlie\u00dfen</a>').click(function(){b.container.hide();return false}).appendTo(a)},drawCalendar:function(){var b=this,c=parseInt(this.calendarMonth),a=parseInt(this.calendarYear);this.calendar.children().remove();var e=$('<table class="calendar"></table>').append($("<tr></tr>").append($('<th colspan="7" class="caption"></th>').append($('<a class="calendarnav-next"></a>').text(">").click(function(){b.drawNextMonth();
return false}),$('<a class="calendarnav-previous"></a>').text("<").click(function(){b.drawPreviousMonth();return false}),$("<span>"+m[c-1]+" "+a+"</span>").click(function(){$(this).hide().after($('<input type="text" />').val(c+"-"+a).change(function(){/(\d{1,2})-(\d{1,2})-(\d+)/.exec($(this).val());if(RegExp.$1)b.drawDate(RegExp.$3,RegExp.$2,RegExp.$1);else{/(\d{1,2})-(\d+)/.exec($(this).val());RegExp.$1&&b.drawDate(RegExp.$2,RegExp.$1)}}).keypress(function(k){if(k.keyCode==13){$(this).change();return false}}).blur(function(){$(this).change()}));
$(this).next().focus()}).attr("title","Klicke hier, um schnell einen anderen Monat auszuw\u00e4hlen")))),f=$("<tbody></tbody>").appendTo(e),d=$("<tr></tr>").appendTo(f);$.each(n,function(k,o){d.append($('<th class="weekday"></th>').text(o))});var g=(new Date(a,c-1,1)).getDay(),j=$.inArray(c,[1,3,5,7,8,10,12])!=-1?31:$.inArray(c,[4,6,9,11])!=-1?30:c==2&&(a%4===0&&a%100!==0||a%400===0)?29:28;d=$("<tr></tr>").appendTo(f);for(var h=0;h<g;h++)$('<td style="background-color: #f3f3f3;"></td>').appendTo(d);
var i=1,p=function(){$(".selected",$(this).parent().parent().parent()).removeClass("selected");$(this).parent().addClass("selected");b.currentDay=$(this).text();b.currentMonth=c;b.currentYear=a;b.writeDateTime();return false};for(h=g;i<=j;h++){if(h%7===0&&i!=1)d=$("<tr></tr>").appendTo(f);g=$("<td></td>").append($("<a></a>").text(i).click(p)).appendTo(d);a==this.currentYear&&c==this.currentMonth&&i==this.currentDay&&g.addClass("selected");i++}for(;d.children().length<7;)d.append($('<td class="nonday"></td>'));
this.calendar.append(e)},drawDate:function(b,c,a){a=parseInt(a);c=parseInt(c);b=parseInt(b);if(c>0&&c<13){this.calendarMonth=c;this.calendarYear=b;if(a){this.currentDay=a;this.currentMonth=c;this.currentYear=b}this.drawCalendar()}},drawPreviousMonth:function(){if(this.calendarMonth==1){this.calendarMonth=12;this.calendarYear--}else this.calendarMonth--;this.drawCalendar()},drawNextMonth:function(){if(this.calendarMonth==12){this.calendarMonth=1;this.calendarYear++}else this.calendarMonth++;this.drawCalendar()},
drawPreviousYear:function(){this.calendarYear--;this.drawCalendar()},drawNextYear:function(){this.calendarYear++;this.drawCalendar()},destroy:function(){this.writeDateTime();this.container.remove();this.input.show()}});$("input").each(function(){var b=this.getAttribute("valuetype");if(b=="datetime")l(this,true);else b=="date"&&l(this,true,true)});$(document).click(function(){$("table.datetime.auto_show").hide()})})();
