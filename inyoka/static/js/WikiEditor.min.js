(function(){var p={text:"Code ohne Highlighting",bash:"Bash",c:"C",csharp:"C#",cpp:"C++",css:"CSS",d:"D","html+django":"Django / Jinja Templates",html:"HTML",irc:"IRC Logs",java:"Java",js:"JavaScript",perl:"Perl","html+php":"PHP",python:"Python",pycon:"Python Console Sessions",pytb:"Python Tracebacks",ruby:"Ruby",sourceslist:"sources.list",sql:"SQL",xml:"XML"},j=function(a,c,b,d,e){return function(f){if(!d||$.inArray(f.profile,d)>-1)return $('<a href="#" class="button" />').attr("id","button-"+a).attr("title",
c).mouseover(function(h){h.preventDefault();e.call(f,h)}).mouseout(function(h){h.preventDefault()}).append($("<span />").text(c)).click(function(h){h.preventDefault();return b.call(f,h)})}},n=function(a,c,b,d,e,f){return function(h){if(!(e&&$.inArray(h.profile,e))){var m=$("<select />").attr("id","dropdown-"+a).attr("title",c).append($('<option class="title" value="" />').text(c)).mouseover(function(l){f.call(h,l)}).mouseout(function(){}).change(function(l){d.call(h,l)});$.each(b,function(){m.append(this)});
m[0].selectedIndex=0;return m}}},g=function(a,c){return $("<option />").val(a).text(c||a)},k=function(a,c){return function(){return this.insertTag(a,typeof c=="undefined"?"Formatierter Text":c)}},i=function(){return function(){}},o=function(a){var c=a.getUTCFullYear(),b=a.getUTCMonth(),d=a.getUTCDate(),e=a.getUTCHours(),f=a.getUTCHours();a=a.getUTCSeconds();return c+"-"+(b<9?"0":"")+(b+1)+"-"+(d<10?"0":"")+d+"T"+(e<10?"0":"")+e+":"+(f<10?"0":"")+f+":"+(a<10?"0":"")+a+"Z"},q=function(){return[n("headline",
"\u00dcberschrift",[g("=","\u00dcberschrift: Stufe 1"),g("==","\u00dcberschrift: Stufe 2"),g("===","\u00dcberschrift: Stufe 3"),g("====","\u00dcberschrift: Stufe 4"),g("=====","\u00dcberschrift: Stufe 5")],function(a){var c=a.target.value;c.length>0&&this.insertTag(c+" %s "+c+"\n","\u00dcberschrift");a.target.selectedIndex=0},["wiki"],i("= \u00dcberschrift =")),j("bold","Fetter Text",k("'''%s'''"),["wiki","forum","small"],i("'''Text'''")),j("italic","Kursiver Text",k("''%s''"),["wiki","forum","small"],
i("''Text''")),j("underlined","Unterstrichener Text",k("__%s__"),["forum","small"],i("__Text__")),j("stroke","Durchgestrichener Text",k("--(%s)--"),["forum"],i("--(Text)--")),j("monospace","Monotype",k("`%s`"),["wiki"],i("`Text`")),j("mark","Hervorgehobener Text",k("[mark]%s[/mark]"),["forum"],i("[mark]Text[/mark]")),j("wiki-link","Wiki-Link",k("[:%s:]","Seitenname"),["wiki","forum"],i("[:Seitenname:(Linktext)]")),j("external-link","Externer Link",k("[%s]","http://www.example.org/"),["wiki","forum",
"small"],i("[www.example.com]")),j("user-link","Benutzerlink",k("[user:%s:]","Benutzername"),["wiki","forum"],i("[user:Beispiel:]")),j("quote","Auswahl zitieren",function(){var a=this.getSelection();a.length&&this.setSelection(this.quoteText(a))},["wiki","forum"],i("Auswahl zitieren")),j("picture","Bild",k("[[Bild(%s)]]","Bildname"),["wiki","forum"],i("[[Bild(Bildname)]]")),j("pre","Codeblock",k("{{{\n%s\n}}}","Code"),["wiki","forum"],i("{{{ Code }}}")),function(a){if(a.profile!="small"){var c=$("<div />");
j("code","Code",function(){b.slideToggle("fast");return false},["wiki","forum"],i("Code einf\u00fcgen"))(a).appendTo(c);var b=$('<table class="codebox" />').appendTo(c).hide();b[0].style.display="none";var d=[$("<td>Rohtext</td>").click(function(){a.insertTag("{{{\n%s\n}}}","Code")})];$.each(p,function(f,h){d.push($("<td>"+h+"</td>").click(function(){a.insertTag("{{{#!code "+f+"\n%s\n}}}","Code")}))});for(var e=0;e<d.length/2;e++)$("<tr />").appendTo(b).append(d[e],d[e+d.length/2]);$(document).click(function(){b.is(":visible")&&
b.slideUp("fast")});return c}},function(a){if(a.profile=="forum"){var c=$("<div />");j("smilies","Smilies",function(){b.slideToggle("fast");return false},["forum"],i("Smiley einf\u00fcgen"))(a).appendTo(c);var b=$('<ul class="smileybox" />').appendTo(c).hide();b[0].style.display="none";$.getJSON("/?__service__=wiki.get_smilies",function(d){$.each(d,function(){var e=this[0],f=this[1];$("<li />").append($("<img />").attr("src",f).attr("alt",e).click(function(){a.insertText(" "+e+" ")})).appendTo(b)})});
$(document).click(function(){b.is(":visible")&&b.slideUp("fast")});return c}},j("date","Datum",function(){this.insertTag("[[Datum(%s)]]",o(new Date))},["wiki"],i("[[Datum(DATUM)]]")),j("sig","Signatur",function(){this.insertText(" --- "+(this.username?"[user:"+this.username.replace(":","::")+":], ":"")+"[[Datum("+o(new Date)+")]]")},["wiki"],i("Signatur einf\u00fcgen")),n("macro","Makro",[g("[[FehlendeSeiten(%s)]]","Fehlende Seiten"),g("[[TagListe(%s)]]","Tag-Liste"),g("[[Anh\u00e4nge(%s)]]","Anh\u00e4nge"),
g("[[Seitenzahl(%s)]]","Seitenzahl"),g("[[Inhaltsverzeichnis(%s)]]","Inhaltsverzeichnis"),g("[[Einbinden(%s)]]","Seite einbinden"),g("[[Seitenliste(%s)]]","Seitenliste"),g("[[Seitenname(%s)]]","Aktueller Seitenname"),g("[[Weiterleitungen(%s)]]","Weiterleitungen"),g("[[\u00c4hnlicheSeiten(%s)]]","\u00c4hnliche Seiten"),g("[[TagWolke(%s)]]","Tag-Wolke"),g("[[Letzte\u00c4nderungen(%s)]]","Letzte \u00c4nderungen"),g("[[VerwaisteSeiten(%s)]]","Verwaiste Seiten"),g("[[NeueSeiten(%s)]]","Neue Seiten")],
function(a){a.target.value.length>0&&this.insertTag(a.target.value,"");a.target.selectedIndex=0},["wiki"],i("Makros einf\u00fcgen")),n("template","Vorlage",[g("[[Vorlage(Tasten, %s)]]","Tasten"),g("{{{#!vorlage Befehl\n%s\n}}}","Befehl"),g("{{{#!vorlage Hinweis\n%s\n}}}","Hinweis"),g("{{{#!vorlage Warnung\n%s\n}}}","Warnung"),g("[[Vorlage(Getestet, %s)]]","Getestet"),g('[[Vorlage(Fremd, Paket, "%s")]]',"Fremdpakete-Warnung"),g('[[Vorlage(Fremd, Quelle, "%s")]]',"Fremdquelle-Warnung"),g("{{{#!vorlage Experten\n%s\n}}}",
"Experten-Info")],function(a){a.target.value.length>0&&this.insertTag(a.target.value,"");a.target.selectedIndex=0},["wiki"],i("Vorlagen einf\u00fcgen")),j("shrink","Eingabefeld verkleinern",function(){var a=this.textarea.height()-50;this.textarea.height(a>=100?a:100).focus()},["forum","wiki"],i("Eingabefeld verkleinern")),j("enlarge","Eingabefeld vergr\u00f6\u00dfern",function(){this.textarea.height(this.textarea.height()+50).focus()},["forum","wiki"],i("Eingabefeld vergr\u00f6\u00dfern"))]};WikiEditor=
Class.$extend({__init__:function(a,c){var b=this,d;this.profile=c||"small";this.username=$CURRENT_USER||"Anonymous";this.smilies=null;this.textarea=$(a);this.textarea[0].inyokaWikiEditor=this;$(this.textarea).keydown(function(l){b.keycodes(b,l)});d=$('<ul class="toolbar" />').prependTo(this.textarea.parent());for(var e=q(),f=0,h=e.length,m;f!=h;++f)if(m=e[f](b))m.appendTo($("<li />").appendTo(d));link=c=="wiki"?"http://wiki.ubuntuusers.de/Wiki/Syntax":"http://wiki.ubuntuusers.de/Forum/Syntax";$('<span class="syntax_help note"><a href="'+
link+'">Hilfe zur Syntax</a></span>').appendTo($("<li />").appendTo(d))},keycodes:function(a,c){if(c.keyCode==13){var b=a.getCurrentLine().match(/^(\s*(?:\*|- |[01aAiI]\.)?\s*)(.*?)$/);if(b[1].length){c.preventDefault();b[2].length?this.insertText("\n"+b[1]):this.setCurrentLine("\n")}}else if(c.keyCode==9){c.preventDefault();b=a.getCurrentLine().length;for(var d=(Math.floor(b/2)+1)*2,e="";b<d&&(e+=" ");++b)this.insertText(e)}},insertTag:function(a,c){var b=this.textarea[0],d=a instanceof Array?a:
a.split("%s",2),e=d[0]||"";d=d[1]||"";scroll=b.scrollTop;if(typeof b.selectionStart!="undefined"){var f=b.selectionStart,h=b.selectionEnd,m=b.value.substring(0,f),l=b.value.substring(f,h),r=b.value.substring(h);l=h!=f?e+l+d:e+c+d;b.value=m+l+r;b.focus();b.selectionStart=f+e.length;b.selectionEnd=f+(l.length-d.length)}else if(typeof document.selection!="undefined"){b.focus();f=document.selection.createRange();h=f.text;f.text=e+(h.length>0?h:c)+d}b.scrollTop=scroll},getSelection:function(){var a=this.textarea[0];
if(typeof a.selectionStart!="undefined"){var c=a.selectionStart,b=a.selectionEnd;return c==b?"":a.value.substring(c,b)}else if(typeof document.selection!="undefined")return document.selection.createRange().text},setSelection:function(a,c){var b=this.textarea[0];if(typeof b.selectionStart!="undefined"){var d=b.selectionStart,e=b.selectionEnd,f=b.value.substring(0,d);e=b.value.substring(e);b.value=f+a+e;b.focus();if(c){b.selectionStart=d;b.selectionEnd=d+a.length}else b.selectionEnd=b.selectionStart=
d+a.length}else if(typeof document.selection!="undefined"){b.focus();document.selection.createRange().text=a}},insertText:function(a){var c=this.textarea[0];if(typeof c.selectionStart!="undefined")c.selectionStart=c.selectionEnd;this.setSelection(a)},getCurrentLine:function(){var a=this.textarea[0],c,b;if(typeof a.selectionStart!="undefined"){var d=[];for(c=a.selectionEnd-1;(b=a.value.charAt(c))!="\n"&&b;c--)d.push(b);d.reverse();for(c=a.selectionEnd;(b=a.value.charAt(c))!="\n"&&b;c++)d.push(b);return d.join("")}return""},
setCurrentLine:function(a){var c=this.textarea[0];if(typeof c.selectionStart!="undefined"){var b,d,e;for(b=c.selectionEnd-1;(e=c.value.charAt(b))!="\n"&&e;b--)for(d=c.selectionEnd;(e=c.value.charAt(d))!="\n"&&e;d++)c.value=c.value.substring(0,b)+a+c.value.substring(d);c.selectionStart=c.selectionEnd=b+a.length}},quoteText:function(a){if(!a)return"";var c=[];$.each(a.split(/\r\n|\r|\n/),function(){c.push(">"+(this.charAt(0)!=">"?" ":"")+this)});return c.join("\n")+"\n"}})})();
