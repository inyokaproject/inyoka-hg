(function(){var p={text:"Code ohne Highlighting",bash:"Bash",c:"C",csharp:"C#",cpp:"C++",css:"CSS",d:"D","html+django":"Django / Jinja Templates",html:"HTML",irc:"IRC Logs",java:"Java",js:"JavaScript",perl:"Perl","html+php":"PHP",python:"Python",pycon:"Python Console Sessions",pytb:"Python Tracebacks",ruby:"Ruby",sourceslist:"sources.list",sql:"SQL",xml:"XML"},j=function(b,a,c,d,e){return function(g){if(!d||$.inArray(g.profile,d)>-1)return $('<a href="#" class="button" />').attr("id","button-"+b).attr("title",
a).mouseover(function(h){h.preventDefault();e.call(g,h)}).mouseout(function(h){h.preventDefault()}).append($("<span />").text(a)).click(function(h){h.preventDefault();return c.call(g,h)})}},n=function(b,a,c,d,e,g){return function(h){if(!(e&&$.inArray(h.profile,e))){var m=$("<select />").attr("id","dropdown-"+b).attr("title",a).append($('<option class="title" value="" />').text(a)).mouseover(function(l){g.call(h,l)}).mouseout(function(){}).change(function(l){d.call(h,l)});$.each(c,function(){m.append(this)});
m[0].selectedIndex=0;return m}}},f=function(b,a){return $("<option />").val(b).text(a||b)},k=function(b,a){return function(){return this.insertTag(b,typeof a=="undefined"?"Formatierter Text":a)}},i=function(){return function(){}},o=function(b){var a;return b.getUTCFullYear()+"-"+(a=b.getUTCMonth(),a<9?"0":"")+(a+1)+"-"+(a=b.getUTCDate(),a<10?"0":"")+a+"T"+(a=b.getUTCHours(),a<10?"0":"")+a+":"+(a=b.getUTCMinutes(),a<10?"0":"")+a+":"+(a=b.getUTCSeconds(),a<10?"0":"")+a+"Z"},q=function(){return[n("headline",
"\u00dcberschrift",[f("=","\u00dcberschrift: Stufe 1"),f("==","\u00dcberschrift: Stufe 2"),f("===","\u00dcberschrift: Stufe 3"),f("====","\u00dcberschrift: Stufe 4"),f("=====","\u00dcberschrift: Stufe 5")],function(b){var a=b.target.value;a.length>0&&this.insertTag(a+" %s "+a+"\n","\u00dcberschrift");b.target.selectedIndex=0},["wiki"],i("= \u00dcberschrift =")),j("bold","Fetter Text",k("'''%s'''"),["wiki","forum","small"],i("'''Text'''")),j("italic","Kursiver Text",k("''%s''"),["wiki","forum","small"],
i("''Text''")),j("underlined","Unterstrichener Text",k("__%s__"),["forum","small"],i("__Text__")),j("stroke","Durchgestrichener Text",k("--(%s)--"),["forum"],i("--(Text)--")),j("monospace","Monotype",k("`%s`"),["wiki"],i("`Text`")),j("mark","Hervorgehobener Text",k("[mark]%s[/mark]"),["forum"],i("[mark]Text[/mark]")),j("wiki-link","Wiki-Link",k("[:%s:]","Seitenname"),["wiki","forum"],i("[:Seitenname:(Linktext)]")),j("external-link","Externer Link",k("[%s]","http://www.example.org/"),["wiki","forum",
"small"],i("[www.example.com]")),j("user-link","Benutzerlink",k("[user:%s:]","Benutzername"),["wiki","forum"],i("[user:Beispiel:]")),j("quote","Auswahl zitieren",function(){var b=this.getSelection();b.length&&this.setSelection(this.quoteText(b))},["wiki","forum"],i("Auswahl zitieren")),j("picture","Bild",k("[[Bild(%s)]]","Bildname"),["wiki","forum"],i("[[Bild(Bildname)]]")),j("pre","Codeblock",k("{{{\n%s\n}}}","Code"),["wiki","forum"],i("{{{ Code }}}")),function(b){if(b.profile!="small"){var a=$("<div />");
j("code","Code",function(){c.slideToggle("fast");return false},["wiki","forum"],i("Code einf\u00fcgen"))(b).appendTo(a);var c=$('<table class="codebox" />').appendTo(a).hide();c[0].style.display="none";var d=[$("<td>Rohtext</td>").click(function(){b.insertTag("{{{\n%s\n}}}","Code")})];$.each(p,function(g,h){d.push($("<td>"+h+"</td>").click(function(){b.insertTag("{{{#!code "+g+"\n%s\n}}}","Code")}))});for(var e=0;e<d.length/2;e++)$("<tr />").appendTo(c).append(d[e],d[e+d.length/2]);$(document).click(function(){c.is(":visible")&&
c.slideUp("fast")});return a}},function(b){if(b.profile=="forum"){var a=$("<div />");j("smilies","Smilies",function(){c.slideToggle("fast");return false},["forum"],i("Smiley einf\u00fcgen"))(b).appendTo(a);var c=$('<ul class="smileybox" />').appendTo(a).hide();c[0].style.display="none";$.getJSON("/?__service__=wiki.get_smilies",function(d){$.each(d,function(){var e=this[0],g=this[1];$("<li />").append($("<img />").attr("src",g).attr("alt",e).click(function(){b.insertText(" "+e+" ")})).appendTo(c)})});
$(document).click(function(){c.is(":visible")&&c.slideUp("fast")});return a}},j("date","Datum",function(){this.insertTag("[[Datum(%s)]]",o(new Date))},["wiki"],i("[[Datum(DATUM)]]")),j("sig","Signatur",function(){this.insertText(" --- "+(this.username?"[user:"+this.username.replace(":","::")+":], ":"")+"[[Datum("+o(new Date)+")]]")},["wiki"],i("Signatur einf\u00fcgen")),n("macro","Makro",[f("[[FehlendeSeiten(%s)]]","Fehlende Seiten"),f("[[TagListe(%s)]]","Tag-Liste"),f("[[Anh\u00e4nge(%s)]]","Anh\u00e4nge"),
f("[[Seitenzahl(%s)]]","Seitenzahl"),f("[[Inhaltsverzeichnis(%s)]]","Inhaltsverzeichnis"),f("[[Einbinden(%s)]]","Seite einbinden"),f("[[Seitenliste(%s)]]","Seitenliste"),f("[[Seitenname(%s)]]","Aktueller Seitenname"),f("[[Weiterleitungen(%s)]]","Weiterleitungen"),f("[[\u00c4hnlicheSeiten(%s)]]","\u00c4hnliche Seiten"),f("[[TagWolke(%s)]]","Tag-Wolke"),f("[[Letzte\u00c4nderungen(%s)]]","Letzte \u00c4nderungen"),f("[[VerwaisteSeiten(%s)]]","Verwaiste Seiten"),f("[[NeueSeiten(%s)]]","Neue Seiten")],
function(b){b.target.value.length>0&&this.insertTag(b.target.value,"");b.target.selectedIndex=0},["wiki"],i("Makros einf\u00fcgen")),n("template","Vorlage",[f("[[Vorlage(Tasten, %s)]]","Tasten"),f("{{{#!vorlage Befehl\n%s\n}}}","Befehl"),f("{{{#!vorlage Hinweis\n%s\n}}}","Hinweis"),f("{{{#!vorlage Warnung\n%s\n}}}","Warnung"),f("[[Vorlage(Getestet, %s)]]","Getestet"),f('[[Vorlage(Fremd, Paket, "%s")]]',"Fremdpakete-Warnung"),f('[[Vorlage(Fremd, Quelle, "%s")]]',"Fremdquelle-Warnung"),f("{{{#!vorlage Experten\n%s\n}}}",
"Experten-Info")],function(b){b.target.value.length>0&&this.insertTag(b.target.value,"");b.target.selectedIndex=0},["wiki"],i("Vorlagen einf\u00fcgen")),j("shrink","Eingabefeld verkleinern",function(){var b=this.textarea.height()-50;this.textarea.height(b>=100?b:100).focus()},["forum","wiki"],i("Eingabefeld verkleinern")),j("enlarge","Eingabefeld vergr\u00f6\u00dfern",function(){this.textarea.height(this.textarea.height()+50).focus()},["forum","wiki"],i("Eingabefeld vergr\u00f6\u00dfern"))]};WikiEditor=
Class.$extend({__init__:function(b,a){var c=this,d;this.profile=a||"small";this.username=$CURRENT_USER||"Anonymous";this.smilies=null;this.textarea=$(b);this.textarea[0].inyokaWikiEditor=this;$(this.textarea).keydown(function(l){c.keycodes(c,l)});d=$('<ul class="toolbar" />').prependTo(this.textarea.parent());for(var e=q(),g=0,h=e.length,m;g!=h;++g)if(m=e[g](c))m.appendTo($("<li />").appendTo(d));link=a=="wiki"?"http://wiki.ubuntuusers.de/Wiki/Syntax":"http://wiki.ubuntuusers.de/Forum/Syntax";$('<span class="syntax_help note"><a href="'+
link+'">Hilfe zur Syntax</a></span>').appendTo($("<li />").appendTo(d))},keycodes:function(b,a){if(a.keyCode==13){var c=b.getCurrentLine().match(/^(\s*(?:\*|- |[01aAiI]\.)?\s*)(.*?)$/);if(c[1].length){a.preventDefault();c[2].length?this.insertText("\n"+c[1]):this.setCurrentLine("\n")}}else if(a.keyCode==9){a.preventDefault();c=b.getCurrentLine().length;for(var d=(Math.floor(c/2)+1)*2,e="";c<d&&(e+=" ");++c);this.insertText(e)}},insertTag:function(b,a){var c=this.textarea[0],d=b instanceof Array?b:
b.split("%s",2),e=d[0]||"";d=d[1]||"";scroll=c.scrollTop;if(typeof c.selectionStart!="undefined"){var g=c.selectionStart,h=c.selectionEnd,m=c.value.substring(0,g),l=c.value.substring(g,h),r=c.value.substring(h);l=h!=g?e+l+d:e+a+d;c.value=m+l+r;c.focus();c.selectionStart=g+e.length;c.selectionEnd=g+(l.length-d.length)}else if(typeof document.selection!="undefined"){c.focus();g=document.selection.createRange();h=g.text;g.text=e+(h.length>0?h:a)+d}c.scrollTop=scroll},getSelection:function(){var b=this.textarea[0];
if(typeof b.selectionStart!="undefined"){var a=b.selectionStart,c=b.selectionEnd;return a==c?"":b.value.substring(a,c)}else if(typeof document.selection!="undefined")return document.selection.createRange().text},setSelection:function(b,a){var c=this.textarea[0];if(typeof c.selectionStart!="undefined"){var d=c.selectionStart,e=c.selectionEnd,g=c.value.substring(0,d);e=c.value.substring(e);c.value=g+b+e;c.focus();if(a){c.selectionStart=d;c.selectionEnd=d+b.length}else c.selectionEnd=c.selectionStart=
d+b.length}else if(typeof document.selection!="undefined"){c.focus();document.selection.createRange().text=b}},insertText:function(b){var a=this.textarea[0];if(typeof a.selectionStart!="undefined")a.selectionStart=a.selectionEnd;this.setSelection(b)},getCurrentLine:function(){var b=this.textarea[0],a,c;if(typeof b.selectionStart!="undefined"){var d=[];for(a=b.selectionEnd-1;(c=b.value.charAt(a))!="\n"&&c;a--)d.push(c);d.reverse();for(a=b.selectionEnd;(c=b.value.charAt(a))!="\n"&&c;a++)d.push(c);return d.join("")}return""},
setCurrentLine:function(b){var a=this.textarea[0];if(typeof a.selectionStart!="undefined"){var c,d,e;for(c=a.selectionEnd-1;(e=a.value.charAt(c))!="\n"&&e;c--);for(d=a.selectionEnd;(e=a.value.charAt(d))!="\n"&&e;d++);a.value=a.value.substring(0,c)+b+a.value.substring(d);a.selectionStart=a.selectionEnd=c+b.length}},quoteText:function(b){if(!b)return"";var a=[];$.each(b.split(/\r\n|\r|\n/),function(){a.push(">"+(this.charAt(0)!=">"?" ":"")+this)});return a.join("\n")+"\n"}})})();
