{#
    admin/monitoring.html
    ~~~~~~~~~~~~~~~~~~~~~

    :copyright: (c) 2007-2010 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'admin/overall.html' %}
{% set navigation_trace = [
    (href('admin', 'monitoring'), 'Monitoring'),
  ] %}
{% set scripts = ['jQuery.visualize.js'] %}
{% set styles = ['visualize.css'] %}
{% block appheader %}
<h1><a href="{{ href('admin') }}">Administration</a></h1>
<h2><a href="{{ href('admin', 'monitoring') }}">Monitoring</a></h2>
{% endblock %}

{% block admin_content %}
<hr />
<h3>Fehlerstatistiken</h3>
<table class="errorstats">
  <tr>
    <th>Offen</th>
    <th>Geschlossen</th>
    <th>neu er√∂ffnet</th>
  </tr>
  <tr>
    <td>{{ stats['open'] }}</td>
    <td>{{ stats['closed'] }}</td>
    <td>{{ stats['reopened'] }}</td>
  </tr>
</table>

<h3>Tracebacks</h3>
<div class="errorlist">
  {%- for error in errors %}
  <h4>{{ error.info }}</h4>
  <pre>{{ error.exc_text }}</pre>
  <ul class="advanced" id="v{{ error.hash }}">
  {%- if not error.frames %}
  {%- set frames = [error.frame] %}
  {%- else %}
  {%- set frames = error.frames %}
  {% endif %}
  {%- for frame in frames %}
    <li class="frame">
      <strong><code>{{ frame.filename }}</code> in <code>{{ frame.function }}</code></strong>

      {% if frame.vars %}
      <table class="vars" id="v{{ error.hash }}">
        <tr>
          <th>Variable</th>
          <th>Value</th>
        </tr>
        {% for var in frame.vars|sort %}
          <tr>
            <td>{{ var[0] }}</td>
            <td class="code"><pre>{{ var[1]|pprint|safe }}</pre></td>
          </tr>
        {% endfor %}
      </table>
      {% endif %}
    </li>
  {% endfor %}
  </ul>

  <p class="details">
    <span>Occured {{ error.occured }} times, Created {{ error.created|datetimeformat }}</span>
    <span class="actions"><a href="#" class="show_frames" id="v{{ error.hash }}">Show frame vars</a> | <a href="{{ href('admin', 'monitoring', close=error.hash) }}">close</a></span>
  </p>
  {%- else %}
  <strong>Es gibt keine Fehler, wir sind die Helden der Welt!</strong>
  {%- endfor %}
</div>

<script type="text/javascript">
  /* <![CDATA[ */
  $(document).ready(function() {
    $('table.errorstats').visualize({
      type: 'pie',
      height: '200px',
      width: '420px',
      parseDirection: 'y',
      appendTitle: false
    });
    $('table.errorstats').hide();

    $('div.errorlist h4').next().toggle();
    $('ul.advanced').toggle();

    $('div.errorlist h4').click(function() {
      $(this).next().slideToggle('fast');
      return false;
    }).css('cursor', 'pointer');

    $('a.show_frames').click(function() {
      id = $(this).attr('id');
      $('ul.advanced[id=' + id + ']').slideToggle('fast');
      return false;
    });
  });
  /* ]]> */
</script>


{% endblock %}
