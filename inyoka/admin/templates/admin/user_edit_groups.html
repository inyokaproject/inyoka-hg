{#
    admin/user_edit_groups.html
    ~~~~~~~~~~~~~~~~~~~~

    Edit the groups of user

    :copyright: (c) 2007-2010 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'admin/overall.html' %}
{% from 'macros.html' import render_form %}

{% macro user_edit_button(link, icon, name) %}
  <li>
    <span><a href="{{ link }}">
      <img src="{{ href('static', 'img/usercp/usercp-%s.png'|format(icon)) }}" alt="{{ name }}" /><br />
      {{ name }}
    </a></span>
  </li>
{% endmacro %}

{% set styles = ['editor-sprite.css', 'datetimefield.css'] %}
{% set scripts = ['WikiEditor.min.js', 'DateTime.min.js', 'PrivilegeBox.min.js', 'UserGroupBox.min.js',
                  'jquery.autocomplete.min.js'] %}

{% set navigation_trace = [
    (href('admin', 'users'), 'Benutzer'),
    (href('admin', 'users', 'edit', user.username), 'Benutzer „%s“ editieren'|format(user.username|e)),
    (href('admin', 'users', 'edit', user.username, 'groups'), 'Gruppen')
] %}

{% block appheader %}
<h1><a href="{{ href('admin') }}">Administration</a></h1>
<h2><a href="{{ href('admin', 'users') }}">Benutzer</a></h2>
{% endblock %}


{% block admin_content %}
<form enctype="multipart/form-data" id="user_edit_form" method="post" action="">
  <h3>Gruppenzugehörigkeiten</h3>
  <table class="user_groups">
    <tr>
      <th>nicht zugehörige Gruppen</th>
      <th class="actions">
        <img src="{{ href('static', 'img/admin/add_item.png') }}" alt="Gruppen hinzufügen" class="item_add" />
        <img src="{{ href('static', 'img/admin/remove_item.png') }}" alt="Gruppen entfernen" class="item_remove" />
      </th>
      <th>zugehörige Gruppen</th>
    </tr>
    <tr>
     <td><select multiple="multiple" size="5" name="user_groups_not_joined"></select></td>
      <td></td>
      <td><select multiple="multiple" size="5" name="user_groups_joined"></select></td>
    </tr>
  </table>
  <dt>{{ form.primary_group.label }}</dt>
  <dd>
    {{ form.primary_group }} <a href="" class="delete_primary_group">löschen</a>
    <p class="note">{{ form.primary_group.help_text }}</p>
  </dd>
  <p><input type="submit" value="Speichern" /></p>
</form>
<script type="text/javascript">
  /* <![CDATA[ */
  var select_form = new GroupBox('#user_edit_box',
    {{ joined_groups|sort|jsonencode }},
    {{ not_joined_groups|sort|jsonencode }}
  );

  $('input[name="group_titles"]').change(function() {
    var value = "";
    $('input[name="group_titles"]:checked').each(function(i) {
      if (i>0) value += " & ";
      value += $(this).val();
    });
    $('#id_member_title').val(value);
  });

  $('select[name="user_groups_joined"]').change(function() {
    var field = $('select[name="user_groups_joined"]');
    $('input[name="primary_group"]').val(field.find('option:selected').val());
  });

  $('a.delete_primary_group').click(function() {
    $('input[name="primary_group"]').val("");
    return false;
  });

  $('input[name="primary_group"]').autocomplete("/?__service__=admin.get_group_autocompletion", {
    delay: 40, maxItemsToShow: 10, limit: 10, minChars: 1
  });

  /* ]]> */
</script>
{% endblock %}
