{#
    ikhaya/detail.html
    ~~~~~~~~~~~~~~~~~~

    Show a single ikhaya article.

    :copyright: 2007 by Benjamin Wiegand.
    :license: GNU GPL.
#}
{% extends 'ikhaya/page.html' %}

{% set title_trace = [article.subject|e] %}
{% set styles = ['editor.css']%}
{% set scripts = ['ikhaya.js', 'WikiEditor.js'] %}

{% block ikhaya_content %}
  <h3 class="title"><a href="{{ article|url }}">{{ article.subject|e }}</a></h3>
  {%- if article.icon -%}
  <img class="icon" src="{{ article.icon.get_img_url() }}" alt="{{ article.icon.identifier }}" />
  {%- endif -%}
  <div class="intro">
    {{ article.rendered_intro }}
  </div>
  
  {{ article.rendered_text }}
  
  <p class="meta">
    geschrieben von <a href="{{ article.author|url }}">
    {{ article.author.username|e}}</a> {{ article.pub_date|specificdatetimeformat(true) }} 
    in <a href="{{ article.category|url }}">{{ article.category.name|e }}</a> 
    {%- if article.edit_count %}
    — {{ article.edit_count }} Mal bearbeitet
    {%- endif %} |
    <a href="{{ article|url('edit') }}">Bearbeiten</a>
  </p>

  <h4><a name="comments">Kommentare</a></h4>
  <ul class="comments">
    {%- for comment in comments %}
    <li class="comment" id="comment_{{ loop.index }}">
      <strong>„{{ comment.title|e }}“</strong> —
      <a name="comment_{{ comment.id }}" href="{{ comment.author|url }}">{{ comment.author.username|e }}</a> von {{ comment.pub_date|specificdatetimeformat(true) }} —
      <a href="#new_comment" onclick="$('#id_text').val($('#id_text').val() + '@' + {{ loop.index }} + ': ')" class="reply">Antworten</a>
      {{ comment.rendered_text }}
    </li>
    {%- else %}
    <li>
      Es wurde noch kein Komentar geschrieben.
    </li>  
    {%- endfor %}
  </ul>
  {%- if USER.is_authenticated %}
  <h4><a name="new_comment">Kommentar schreiben</a></h4>
  <p class="note">

  </p>
  <form action="{{ article|url }}#new_comment" method="post">
    {{ h.render_form(form, 'title', 'text') }}
    <p>
      <input type="submit" value="Absenden" />
    </p>
  </form>
  <script type="text/javascript">
    /* <![CDATA[ */
    var text = new WikiEditor('textarea[@name="text"]');
    /* ]]> */
  </script>
  {%- endif %}
{% endblock %}
