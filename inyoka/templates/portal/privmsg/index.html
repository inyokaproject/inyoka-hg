{#
    portal/privmsg/index.html
    ~~~~~~~~~~~~~~~~~~~~~~~~~

    Display a list of private messages.

    :copyright: 2007-2008 by Christoph Hack, Benjamin Wiegand,
                             Christopher Grebs.
    :license: GNU GPL.
#}
{%- extends 'portal/privmsg/overall.html' %}
{% set selected = folder.id %}
{% set title_trace = [folder.name] %}

{% block portal_content %}
   {%- if message %}
    <div class="prvmsg">
      <img class="avatar" src="{{ message.author.avatar_url|e }}" alt="Avatar von {{ message.author.username|e }}" />
      <dl class="prvmsg_header">
        <dt>Von:</dt>
        <dd><a href="{{ message.author|url }}">{{ message.author|e }}</a></dd>
        <dt>An:</dt>
        <dd>{% for user in message.recipients -%}
          <a href="{{ user|url }}">{{ user|e }}</a>
          {%- if not loop.last %}, {% endif %}{% else %}...{% endfor %}</dd>
        <dt>Betreff:</dt>
        <dd>{{ message.subject|e }}</dd>
        <dt>Datum:</dt>
        <dd>{{ message.pub_date|datetimeformat }}</dd>
      </dl>
      <div class="prvmsg_body">
        {{ message.rendered_text }}
      </div>
      <div class="linklist pn_actions">
        <a class="pn_reply" href="{{ message|url('reply') }}">Antworten</a> |
        <a class="pn_forward" href="{{ message|url('forward') }}">Weiterleiten</a> |
        {%- if folder.id == 'trash' %}
        <a class="pn_restore" href="?action=restore">Wiederherstellen</a> |
        {%- elif folder.id != 'archive' %}
        <a class="pn_archive" href="?action=archive">Archivieren</a> |
        {%- endif %}
        <a class="pn_delete" href="?action=delete">Nachricht löschen</a>
      </div>
    </div>
    <br/>
    <div>Solltest du eine offensichtliche Werbenachricht erhalten haben, leite diese bitte an einen der <a href="http://wiki.ubuntuusers.de/ubuntuusers/Moderatoren">Moderatoren</a> weiter. Beleidigungen oder Streitereien die über PNs ausgetragen werden sind eure Privatangelegenheit, bitte regelt so etwas unter euch.</div>
  {%- endif %}

 <table class="pms">
    <thead>
      <tr>
        <th class="subject">Betreff</th>
        <th class="author">Von</th>
        <th class="recipients">An</th>
        <th class="date">Datum</th>
        <th class="actions">Aktionen</th>
        <th class="delete" style="white-space: nowrap">Löschen</th>
      </tr>
    </thead>
    <form action="" method="post">
      <tbody>
        {%- for entry in entries %}
        <tr{% if message == entry.message %} class="active_pn"{% endif %}>
          <td>{% if not entry.read %}<strong>{% endif -%}
          <a href="{{ entry|url }}">{{ entry.message.subject|e }}</a>
          {%- if not entry.read %}</strong>{% endif %}</td>
          <td><a href="{{ entry.message.author|url }}">
            {{ entry.message.author|e }}</a></td>
          <td>
            {%- if entry.message.recipients|length == 0 %}
              <a href="{{ entry.message.author|url }}">
                {{ entry.message.author|e }}</a>
            {% else %}
              <a href="{{ entry.message.recipients[0]|url }}">
                {{ entry.message.recipients[0]|e }}</a>
            {%- endif %}
            {%- if entry.message.recipients|length > 1 %}, ...{% endif %}</td>
          <td>{{ entry.message.pub_date|datetimeformat }}</td>
          <td class="actions">
            {%- if not entry.is_own_message %}
            <a href="{{ entry|url('reply') }}" class="pn_reply" title="Antworten" />
            {%- endif %}
            <a href="{{ entry|url('forward') }}" class="pn_forward" title="Weiterleiten" />
            {%- if not entry.in_archive %}
            <a href="{{ entry|url }}?action=archive" class="pn_archive" title="Archivieren" />
            {%- endif %}
          </td>
          <td class="pn_delete"><input type="checkbox" name="delete" value="{{ entry.id }}" /></td>
        </tr>
        {%- else %}
        <tr>
          <td colspan="5">Derzeit befinden sich noch keine Nachrichten
          in diesem Ordner.</td>
        </tr>
        {%- endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td><p><a href="{{ href('portal', 'privmsg', 'new') }}">Neue Nachricht schreiben</a></p></td>
          <td><p><input type="submit" value="Markierte Nachrichten löschen" class="linkbutton" /></p></td>
          <td colspan="4">
            <div style="float: right;">
              {{ pagination }}
            </div>
          </td>
        </tr>
        <tr>
          {% if one_page %}
          <td><p><a href="{{ href('portal', 'privmsg', folder.id) }}">Nachrichten auf mehrere Seiten aufteilen</a></p></td>
          {% else %}
          <td><p><a href="{{ href('portal', 'privmsg', folder.id, 'page', '0') }}">Alle Nachrichten auf einer Seite anzeigen</a></p></td>
          {% endif %}
        </tr>
      </tfoot>
    </form>
  </table>
<script type="text/javascript">
  /* <![CDATA[ */
  var all_checked = false;
  $('table.pms th.delete').click(function() {
    $('input[@name="delete"]').each(function() {
      if (all_checked)
        this.checked = false;
      else
        this.checked = true;
    });
    if (all_checked)
      all_checked = false;
    else
      all_checked = true;
  });
  /* ]]> */
</script>
{% endblock %}
